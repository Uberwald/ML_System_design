### 1. Цели и предпосылки  

#### 1.1. Зачем идем в разработку продукта?  

- **Бизнес-цель**  
  - Создать инструмент, который будет предсказывать наиболее склонных к оформлению кредитных карт клиентов банка в малоизученном пользовательском сегменте. Это позволит:  
    - Эффективнее таргетировать маркетинговые кампании
    - Помочь лучше изучить сегмент клиентов банка, которые не являются абонентами мобильного оператора, в сравнении с уже хорошо изученным сегментом абонентов
    - Всё это поможет повысить прибыль компании

- **Почему станет лучше, чем сейчас, от использования ML**  

  - **Текущая ситуация**:  
    - Прогнозы строятся исключительно на данных из банковских источников.  
    - Отсутствует персонализация для неабонентов, связанная с их окружением.  

- **Улучшения с использованием ML**:  
  - Включение данных об окружении неабонента (агрегированные признаки абонентов, с которыми он взаимодействовал) позволяет учитывать больше факторов, влияющих на поведение клиента.  
  - Использование исторических данных и выявление сложных зависимостей с помощью модели повышает качество рекомендаций.  
  - Более точное предсказание склонности к оформлению кредитной карты благодаря анализу множества факторов, недоступных в рамках текущего подхода.  

- **Что будем считать успехом итерации с точки зрения бизнеса**

  - **Краткосрочные метрики**:
  
      Увеличение конверсии откликов на таргетированную кампанию на 3–5% по сравнению с базовой стратегией.
  
  - **Долгосрочные цели**:
  
      Рост доли клиентов, оформивших кредитные карты, на 20% среди выбранной целевой группы.
      Увеличение LTV (Lifetime Value) клиентов, вовлеченных с помощью модели.


#### 1.2. Бизнес-требования и ограничения  

- **Краткое описание БТ и ссылки на детальные документы с бизнес-требованиями** `Product Owner`   
  - Пока нет
- **Бизнес-ограничения** `Product Owner`   
Ограничены используемыми продуктами: кредитные карты. Ограничены источниками данных 
- **Что мы ожидаем от конкретной итерации** `Product Owner`      
  - Получить ML метрики, обосновывающие применение подхода с использованием данных из мобильного окружения клиента банка
- **Описание бизнес-процесса пилота, насколько это возможно - как именно мы будем использовать модель в существующем бизнес-процессе?** `Product Owner`   
  - Модель планируется отправить в подразделение Банка, где она будет использоваться в камапниях по привлечению новых пользователей кредитных продуктов.
- **Что считаем успешным пилотом? Критерии успеха и возможные пути развития проекта** `Product Owner`   
  - Улучшение коверсии на 1-5%

#### 1.3. Что входит в скоуп проекта/итерации, что не входит   

- **На закрытие каких БТ подписываемся в данной итерации** `Data Scientist`
  - Улучшение конверии на 1-2%
- Что не будет закрыто `Data Scientist`
  - Улучшение конверсии на 3-5%
- Описание результата с точки зрения качества кода и воспроизводимости решения `Data Scientist`
  - Получится набор .py скриптов для получения не абонентов и фичей к ним, а также модель формата .pkl, всё будет залито в Git
- Описание планируемого технического долга (что оставляем для дальнейшей продуктивизации) `Data Scientist`
  - Использование дополнительных источников, создание пайплайна для удобной работы

#### 1.4. Предпосылки решения  

### Общие предпосылки решения

#### Запрос бизнеса
Банк стремится определить, какие клиенты, не являющиеся абонентами МТС, с высокой вероятностью оформят кредитную карту. Это решение направлено на повышение эффективности маркетинговых кампаний и углубление знаний о сегменте [клиент банка — не абонент].

#### Используемые блоки данных
Для решения задачи модель использует:
1. **Окружение клиента (неабонента)**:
   - Агрегированные признаки абонентов МТС, с которыми общался клиент (сведения о звонках, различные банковские признаки абонентов).
   - **Обоснование**: Окружение влияет на вероятность покупки, так как люди склонны принимать финансовые решения под влиянием своего круга общения.

2. **Банковские данные клиента**:
   - Возраст, доход, количество продуктов банка, активность.
   - **Обоснование**: Эти данные дают прямую характеристику клиента и его финансового поведения.

#### Горизонт прогноза
Модель прогнозирует вероятность оформления карты в течение ближайших **14 дней**. Этот горизонт выбран, чтобы использовать актуальные данные о пользователе.

#### Гранулярность модели
Модель работает на уровне отдельного клиента (неабонента), выдавая вероятность оформления кредитной карты. Этот уровень гранулярности позволяет реализовать персонализированный подход и повысить конверсию.
### 2. Методология `Data Scientist`     

#### 2.1. Постановка задачи  

  - Задача состоит в обучении классификатора Catboost на наиболее важных фичах. Данный классификатор выбран ввиду его универсальности при работе с данными, что позволит существенно сократить время и ресурсы на предварительную обработку данных

#### 2.2. Блок-схема решения  

- Блок-схема для бейзлайна и основного MVP с ключевыми этапами решения задачи: подготовка данных, построение прогнозных моделей, оптимизация, тестирование, закрытие технического долга, подготовка пилота, другое. `Data Scientist`  
- [Пример возможной блок схемы](https://github.com/IrinaGoloshchapova/ml_system_design_doc_ru/blob/main/product_schema.png?raw=true)
> Схема обязательно включает в себя архитектуру бейзлайна. Если бейзлайн и основной MVP отличаются несущественно, то это может быть одна блок-схема. Если значительно, то рисуем две: отдельно для бейзлайна, отдельно для основного MVP.  
> Если блок-схема **шаблонна** - т.е. её можно скопировать и применить к разным продуктам, то она **некорректна**. Блок-схема должна показывать схему решения для конкретной задачи, поставленной в части 1.    

#### 2.3. Этапы решения задачи `Data Scientist`  

- Этап 1 - Отбор неабонентов и таргета в определенно интервале
- Этап 2 - Сбор признаков источника С360 и построение **бейзлайна**
- Этап 3 - Сбор признаков из остальных источников
- Этап 4 - Отбор признаков
- Этап 6 - Проведение ретро теста
- Этап 7 - Добавление новых источников и проведение тестов
- Этап 8 - Подготовка инференса модели  
- Этап 9 - Подготовка документации и скриптов
- Этап 10 - Подготовка финального отчета для бизнеса  

  
| Название данных  | Есть ли данные в компании (если да, название источника/витрин) | Требуемый ресурс для получения данных (какие роли нужны) | Проверено ли качество данных (да, нет) |
| ------------- | ------------- | ------------- | ------------- |
| Граф неабонентов с таргетом | aafan_target_apr_sept_2024  | DE/DS | + |
| Граф звокнов с таргетом | aafan_calls_apr_sept_2024  | DE/DS | + |
| С360 (звонковая активность) | agg__c360min  | DE/DS | + |
| service_category | service_category  | DE/DS | + |
| agg_charge | fintech_leadgen_ml_features_agg_charge_d  | DE/DS | + |
| agg_usage | fintech_leadgen_ml_features_agg_usage_d  | DE/DS | + |
| dm_cc_eligible | cc_eligible  | DE/DS | + |
| esr | fintech_leadgen_ml_features  | DE/DS | + |
| bank_charge_sms | mtsru_a2pnews_msk_a2pnews__bank  | DE/DS | + |
 
- Должна получится единая таблица номер неабонента -> признаки -> бизнес дата -> таргет

 *Этапы 2 и далее, помимо подготовки данных.*
 
Описание техники **для каждого этапа** должно включать описание **отдельно для MVP** и **отдельно для бейзлайна**:  

- Описание формирования выборки для обучения, тестирования и валидации. Выбор репрезентативных данных для экспериментов, обучения и подготовки пилота (от бизнес-цели и репрезентативности данных с технической точки зрения) `Data Scientist`
  - Тренировочные данные берутся с апреля по июнь, валидационные июль-август, тестовые - сентябрь
- Горизонт, гранулярность, частоту необходимого пересчета прогнозных моделей `Data Scientist`
  -  Горизонт выбран в 14 дней, пересчет планируется делать каждые 2 или 4 недели, в зависимости от скорости сбора данных и обучения модели
- Определение целевой переменной, согласованное с бизнесом `Data Scientist`
  - Тарегет = 0 - если клиент не оформил кредитную карту в течение 21 дня после рекламной коммуникации
  - Таргет = 1 - если клиент оформил кредитную карту в течение 21 дня после рекламной коммуникации
- Какие метрики качества используем и почему они связаны с бизнес-результатом
  - ML метрики: AUC (как базовый показатель адекватности модели), recall (нам важено захватить как можно большую часть потенциальных единичек, даже если придется набрать некоторое количество ноликов)
- Необходимый результат этапа. Например, необходимым результатом может быть не просто достижение каких-либо метрик качества, а включение в модели определенных факторов (флаг промо для прогноза выручки, др.) `Data Scientist`
  - AUC не менее 0.6, recall не менее 0.6   
- Какие могут быть риски и что планируем с этим делать. Например, необходимый для модели фактор (флаг промо) окажется незначимым для большинства моделей. Или для 50% моделей будет недостаточно данных для оценки `Data Scientist`
  -  Возможно, что метрики не будут достигнуты, тогда нужно попробовать новые источники данных
- Верхнеуровневые принципы и обоснования для: feature engineering, подбора алгоритма решения, техники кросс-валидации, интерпретации результата (если применимо).
  - Отбираем наиболее важные фичи с помощью внутренней библиотеки
  - Используем TimeSeriesSplit, потому что это круто и правильно для исторических данных
- Предусмотрена ли бизнес-проверка результата этапа и как будет проводиться `Data Scientist` & `Product Owner`
  - Планируется закрытое тестирование Банком, а они пока не рассказывают   
  
### 3. Подготовка пилота  
  
#### 3.1. Способ оценки пилота  
  
- Краткое описание предполагаемого дизайна и способа оценки пилота `Product Owner`, `Data Scientist` with `AB Group`
  - Планируется взять пользователей за последние полгода и посчитать для них скор, а потом проверить на нескольких топах (1 млн, 5 млн, 10 млн) конверсию
  
#### 3.2. Что считаем успешным пилотом  
  
Конверсия чуть выше базового уровня (не могу привести цифры, но из-за специфики отрасли понятно, что в процентном соотношении разницу в конверсии почти не увидеть даже если мы сможем успешно подтолкнуть всех потенциальных клиентов к оформлению КК) [Требует доработки, пока не знаю точно]
  
#### 3.3. Подготовка пилота  
  
- Что можем позволить себе, исходя из ожидаемых затрат на вычисления. Если исходно просчитать сложно, то описываем этап расчетов ожидаемой вычислительной сложности на эксперименте с бейзлайном. И предусматриваем уточнение параметров пилота и установку ограничений по вычислительной сложности моделей. `Data Scientist`
  - Модель не должна обучаться дольше суток 

### 4. Внедрение `для production систем, если требуется` (Не требуется)
